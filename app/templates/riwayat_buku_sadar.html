<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <style>
        body { font-family: sans-serif; margin: 2em; background-color: #f4f7f6; }
        nav { margin-bottom: 2em; }
        nav a { margin-right: 1em; }
        table { width: 100%; border-collapse: collapse; margin-top: 1.5em; background-color: white; font-size: 12px; }
        th, td { border: 1px solid #ddd; padding: 6px; text-align: center; }
        th { background-color: #e9ecef; }
        td.nama { text-align: left; }
        .filter-form { background-color: white; padding: 1.5em; border-radius: 8px; }
        .filter-form form { display: flex; align-items: flex-end; gap: 1em; }
    </style>
</head>
<body>
    <nav>
        <a href="{{ url_for('admin.admin_dashboard') }}">Dashboard</a>
        <a href="{{ url_for('admin.riwayat_absensi') }}">Riwayat Absensi</a>
        <a href="{{ url_for('admin.riwayat_buku_sadar') }}">Riwayat Buku Sadar</a>
        <a href="{{ url_for('admin.list_riwayat_buku_sadar') }}">Daftar Catatan</a>
    </nav>
    
    <h1>{{ title }}</h1>

    <div class="filter-form">
        <h4>Filter Data</h4>
        <form method="GET" action="{{ url_for('admin.riwayat_buku_sadar') }}">
            <div>
                <label for="month">Bulan</label><br>
                <input type="month" name="month" id="month" value="{{ q_month_str }}">
            </div>
            <div>
                <label for="santri_id">Nama Santri</label><br>
                <select name="santri_id" id="santri_id">
                    <option value="">-- Semua Santri --</option>
                    {% for s in semua_santri %}
                    <option value="{{ s.id }}" {% if s.id == q_santri_id %}selected{% endif %}>{{ s.nama_lengkap }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label for="kelas">Nama Kelas</label><br>
                <input type="text" name="kelas" id="kelas" value="{{ q_kelas or '' }}">
            </div>
            <div>
                <button type="submit">Filter</button>
                <a href="{{ url_for('admin.riwayat_buku_sadar') }}">Reset</a>
                <a href="{{ url_for('admin.export_riwayat_buku_sadar', month=q_month_str, santri_id=q_santri_id, kelas=q_kelas) }}"
               style="margin-left: 1em; padding: 6px 10px; background-color: #198754; color: white; text-decoration: none; border-radius: 4px; font-size: 14px;">
               Ekspor ke Excel
                </a>
            </div>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th rowspan="2">NO</th>
                <th rowspan="2">NAMA</th>
                <th rowspan="2">KELAS</th>
                <th colspan="{{ days_in_month|length }}">TANGGAL</th>
                <th rowspan="2">TOTAL</th>
                <th rowspan="2">KETERANGAN</th>
                <th rowspan="2">RIYADHOH</th>
                <th rowspan="2">LUNAS</th>
            </tr>
            <tr>
                {% for day in days_in_month %}
                <th>{{ day }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for nama, data in processed_data.items() %}
            <tr>
                <td>{{ loop.index }}</td>
                <td class="nama">{{ nama }}</td>
                <td>{{ data.kelas }}</td>
                {% for day in days_in_month %}
                    <td>{{ data.infractions.get(day, '') }}</td>
                {% endfor %}
                <td><b>{{ data.total }}</b></td>
                <td class="nama">{{ ', '.join(data.keterangan_list) }}</td>
                <td class="nama">{{ ', '.join(data.riyadhoh_list) }}</td>
                <td>{{ data.lunas_status }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="100%" style="text-align: center;">Tidak ada data untuk bulan ini.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>